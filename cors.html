<html>
	<head>
		<title>Common CORS issues</title>
		<style>
			h1 {text-align: center;}
			h4 {text-align: center;}
			input {height: 22px; margin-left: 5px;}
			div {display: flex; justify-content: center; align-items: center;}
			button {margin: 10px;}
		</style>
	</head>
	<body>
		<h1>Common CORS issues</h1>
		<h4>Do not edit this file, only edit .conf files in the Apache.</h4>
		
		<br><br><br>
		
		<div>
			<p>Website address:</p>
			
			<input type="text" id="address" placeholder="http://cors.site.demo">
		</div>
		
		<br>
		
		<div>
			<button onclick="test()" id="test">Test connection</button>
			<button onclick="issue1()" id="issue1">Issue 1</button>
			<button onclick="issue2()" id="issue2">Issue 2</button>
		</div>
		
		<script>
			function disableInput(){
				document.body.style.cursor='wait';
				document.getElementById("address").style.cursor='wait';
				document.getElementById("test").style.cursor='wait';
				document.getElementById("issue1").style.cursor='wait';
				document.getElementById("issue2").style.cursor='wait';
				document.getElementById("address").disabled = true;
				document.getElementById("test").disabled = true;
				document.getElementById("issue1").disabled = true;
				document.getElementById("issue2").disabled = true;
			}
			function enableInput(){
				document.body.style.cursor='default';
				document.getElementById("address").style.cursor='default';
				document.getElementById("test").style.cursor='default';
				document.getElementById("issue1").style.cursor='default';
				document.getElementById("issue2").style.cursor='default';
				document.getElementById("address").disabled = false;
				document.getElementById("test").disabled = false;
				document.getElementById("issue1").disabled = false;
				document.getElementById("issue2").disabled = false;
			}
		
			async function test(){
				let address = document.getElementById("address").value;
				if (address.length == 0){
					alert("Website address field cannot be empty!");
					
					return
				}
				
				disableInput();
				
				let fixed = false;				
				try{
					let response = await fetch(address, {
						method: "POST",
						referrer: "http://cors.com",
						mode: "cors",
						keepalive: true
					});
					
					if (!response.ok){
						console.error(`Response status: ${response.status}`);
					}else{
						console.log(response);
						fixed = true;
					}
				}
				catch(error){
					console.error(error.message);
				}
			
				enableInput();
				
				if(fixed){
					alert("Connection successful!");
				}else{
					alert("Connection failed!\n\nFor more information check the browswer console.");
				}
			}
			async function issue1(){
				let address = document.getElementById("address").value;
				if (address.length == 0){
					alert("Website address field cannot be empty!");
					
					return
				}
				
				disableInput();
				
				let fixed = false;				
				try{
					let response = await fetch(address+"/issue1", {
						method: "POST",
						referrer: "http://cors.com",
						mode: "cors",
						keepalive: true
					});
					
					if (!response.ok){
						console.error(`Response status: ${response.status}`);
					}else{
						console.log(response);
						fixed = true;
					}
				}
				catch(error){
					console.error(error.message);
				}
			
				enableInput();
				
				if(fixed){
					alert("Issue 1 has been fixed!");
				}else{
					alert("Issue 1 has not been fixed!\n\nFor more information check the browswer console.");
				}
			}
			async function issue2(){			
				let address = document.getElementById("address").value;
				if (address.length == 0){
					alert("Website address field cannot be empty!");
					
					return
				}
				
				disableInput();
				
				let fixed = false;				
				try{
					let response = await fetch(address+"/issue2", {
						method: "POST",
						referrer: "http://cors.com",
						mode: "cors",
						keepalive: true
					});
					
					if (!response.ok){
						console.error(`Response status: ${response.status}`);
					}else{
						console.log(response);
						fixed = true;
					}
				}
				catch(error){
					console.error(error.message);
				}
			
				enableInput();
				
				if(fixed){
					alert("Issue 2 has been fixed!");
				}else{
					alert("Issue 2 has not been fixed!\n\nFor more information check the browswer console.");
				}
			}
		</script>
	</body>
</html>